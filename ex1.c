#include<stdio.h>
#include<math.h>
void line(int a[30],int *a0,int *b0);
int main(){
	#define analyze_number 28 //设置分析的样点数目,采样为x*x
    #define delete_left 1	//设置左边和上面删除的行和列
    #define delete_right 1	//设置右边和下面删除的行和列
	#define limit_number 5	//设置阈值
	int a[30][30] = {0xCE,0x8D,0x8F,0x91,0x93,0x94,0x96,0x96,0x97,0x97,0x9A,0x98,0x99,0x9A,0x99,0x99,0x98,0x97,0x97,0x96,0x95,0x93,0x92,0x91,0x8F,0x8E,0x8C,0x8B,0x89,0x87,0x91,0x92,0x94,0x95,0x98,0x99,0x9A,0x9C,0x9D,0x9E,0x9E,0x9F,0xA0,0xA0,0x9F,0x9F,0x9D,0x9C,0x9B,0x9B,0x9A,0x98,0x97,0x95,0x94,0x92,0x91,0x8F,0x8D,0x8B,0x93,0x94,0x96,0x98,0x9A,0x9B,0x9D,0x9E,0x9F,0xA0,0xA0,0xA0,0xA2,0xA1,0xA1,0xA0,0x9E,0x9E,0x9E,0x9D,0x9C,0x9A,0x99,0x97,0x96,0x94,0x92,0x90,0x8E,0x8C,0x94,0x96,0x98,0x9B,0x9C,0x9E,0x9F,0xA0,0xA2,0xA2,0xA2,0xA4,0xA4,0xA4,0xA4,0xA3,0xA2,0xA2,0xA1,0xA0,0x9F,0x9D,0x9B,0x99,0x97,0x95,0x93,0x91,0x8F,0x8D,0x96,0x98,0x9A,0x9D,0x9E,0xA0,0xA2,0xA3,0xA5,0xA6,0xA7,0xA8,0xA9,0xA8,0xA8,0xA7,0xA6,0xA4,0xA4,0xA2,0xA1,0x9F,0x9D,0x9B,0x99,0x97,0x94,0x92,0x90,0x8E,0x98,0x9A,0x9D,0x9F,0xA1,0xA3,0xA5,0xA6,0xA8,0xA9,0xAA,0xAB,0xAB,0xAB,0xAA,0xAA,0xA9,0xA8,0xA6,0xA5,0xA3,0xA1,0x9F,0x9D,0x9B,0x98,0x96,0x94,0x92,0x90,0x9A,0x9C,0x9F,0xA1,0xA2,0xA4,0xA7,0xA8,0xAA,0xAB,0xAD,0xAE,0xAF,0xAE,0xAD,0xAD,0xAD,0xAB,0xA9,0xA7,0xA5,0xA4,0xA2,0x9E,0x9C,0x9A,0x91,0x90,0x93,0x91,0x9C,0x9D,0xA0,0xA3,0xA3,0xA6,0xA9,0xAB,0xAD,0xAD,0xAF,0xB0,0xB1,0xB1,0xB1,0xAF,0xAF,0xAD,0xAB,0xA9,0xA7,0xA6,0xA3,0xA0,0x9E,0x9C,0x99,0x92,0x94,0x92,0x9E,0x9F,0xA2,0xA2,0xA4,0xA9,0xAB,0xAD,0xAF,0xB0,0xB2,0xB3,0xB3,0xB3,0xB3,0xB2,0xB1,0xB0,0xAD,0xAB,0xA8,0xA5,0xA2,0x9F,0x9D,0x98,0x97,0x93,0x91,0x8E,0x9E,0xA1,0xA4,0xA6,0xA7,0xA7,0xAA,0xAF,0xB1,0xB2,0xB3,0xB4,0xB2,0xAE,0xAE,0xAC,0xA8,0xA4,0xA0,0x9B,0x97,0x94,0x91,0x8E,0x8C,0x8A,0x89,0x87,0x85,0x84,0x9F,0xA2,0xA3,0xA8,0xA7,0xAB,0xA7,0xAA,0xA8,0xA5,0xA1,0x9E,0x99,0x95,0x92,0x8F,0x8D,0x8B,0x8A,0x89,0x88,0x88,0x88,0x87,0x87,0x86,0x86,0x85,0x83,0x82,0x9D,0x9B,0x9E,0x9D,0x9A,0x97,0x93,0x91,0x8D,0x8B,0x8A,0x89,0x89,0x89,0x89,0x89,0x89,0x88,0x88,0x88,0x88,0x87,0x87,0x86,0x86,0x86,0x85,0x84,0x84,0x81,0x8C,0x8B,0x8A,0x88,0x88,0x87,0x88,0x87,0x88,0x87,0x87,0x88,0x88,0x88,0x88,0x89,0x89,0x88,0x88,0x87,0x87,0x86,0x86,0x86,0x86,0x86,0x85,0x84,0x83,0x83,0x85,0x86,0x86,0x86,0x86,0x87,0x84,0x87,0x88,0x84,0x86,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x86,0x86,0x86,0x86,0x86,0x85,0x85,0x85,0x84,0x84,0x83,0x85,0x85,0x86,0x86,0x86,0x87,0x87,0x88,0x87,0x87,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x86,0x85,0x86,0x86,0x85,0x85,0x85,0x85,0x85,0x84,0x84,0x83,0x85,0x85,0x86,0x86,0x86,0x87,0x87,0x87,0x87,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x86,0x86,0x86,0x86,0x86,0x86,0x85,0x85,0x85,0x84,0x84,0x83,0x85,0x85,0x86,0x86,0x86,0x86,0x87,0x87,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x87,0x86,0x87,0x86,0x86,0x86,0x85,0x85,0x84,0x84,0x83,0x85,0x85,0x85,0x85,0x86,0x86,0x87,0x87,0x88,0x88,0x88,0x87,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x86,0x87,0x87,0x86,0x86,0x86,0x85,0x85,0x84,0x84,0x83,0x85,0x85,0x85,0x86,0x86,0x86,0x87,0x87,0x87,0x88,0x88,0x88,0x87,0x87,0x88,0x88,0x85,0x88,0x87,0x87,0x87,0x87,0x86,0x86,0x85,0x85,0x84,0x84,0x84,0x83,0x85,0x85,0x85,0x85,0x86,0x86,0x86,0x87,0x87,0x87,0x88,0x87,0x87,0x87,0x82,0x88,0x88,0x87,0x87,0x87,0x87,0x86,0x86,0x85,0x85,0x85,0x84,0x84,0x83,0x83,0x84,0x84,0x85,0x85,0x85,0x86,0x86,0x87,0x87,0x87,0x87,0x87,0x88,0x88,0x87,0x88,0x88,0x87,0x87,0x86,0x86,0x86,0x86,0x85,0x84,0x85,0x84,0x84,0x83,0x83,0x84,0x84,0x85,0x85,0x85,0x86,0x86,0x87,0x87,0x87,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x88,0x87,0x88,0x88,0x88,0x87,0x87,0x87,0x86,0x86,0x85,0x84,0x86,0x86,0x87,0x88,0x89,0x8B,0x8C,0x8D,0x8F,0x90,0x92,0x93,0x94,0x96,0x97,0x99,0x9A,0x9A,0x9B,0x9B,0x9C,0x9C,0x9B,0x99,0x99,0x97,0x95,0x93,0x92,0x90,0x95,0x97,0x99,0x9C,0x9E,0xA0,0xA2,0xA4,0xA6,0xA8,0xAA,0xAB,0xAC,0xAD,0xAE,0xAF,0xAE,0xAD,0xAA,0xAA,0xA9,0xA7,0xA4,0xA3,0xA0,0x9D,0x9A,0x97,0x95,0x92,0x9B,0x9D,0x9F,0xA1,0xA3,0xA5,0xA7,0xA4,0xAA,0xAC,0xAD,0xAD,0xAE,0xAF,0xAF,0xAE,0xAE,0xAB,0xA9,0xA8,0xA8,0xA5,0xA3,0xA1,0x9E,0x9B,0x99,0x96,0x93,0x91,0x99,0x9C,0x9C,0x9F,0xA2,0xA3,0xA4,0xA6,0xA8,0xA9,0xAB,0xAB,0xAB,0xAC,0xAB,0xAB,0xAA,0xA8,0xA7,0xA6,0xA5,0xA3,0xA1,0x9E,0x9C,0x9A,0x97,0x95,0x92,0x8F,0x98,0x99,0x9B,0x9C,0x9F,0xA1,0xA2,0xA3,0xA4,0xA6,0xA7,0xA8,0xA8,0xA8,0xA9,0xA8,0xA7,0xA6,0xA5,0xA3,0xA2,0xA0,0x9E,0x9C,0x9A,0x98,0x95,0x93,0x91,0x8E,0x96,0x98,0x99,0x9B,0x9D,0x9F,0xA0,0xA1,0xA3,0xA3,0xA5,0xA5,0xA5,0xA5,0xA6,0xA5,0xA4,0xA4,0xA2,0xA1,0x9F,0x9E,0x9B,0x9A,0x98,0x96,0x94,0x91,0x8F,0x8D,0x94,0x96,0x97,0x99,0x9B,0x9C,0x9D,0x9E,0x9F,0xA1,0xA1,0xA2,0xA2,0xA3,0xA2,0xA2,0xA2,0x9D,0x9F,0x9E,0x9D,0x9B,0x99,0x97,0x96,0x94,0x91,0x90,0x8D,0x8B,0x92,0x93,0x95,0x96,0x98,0x99,0x9A,0x9C,0x9C,0x9D,0x9E,0x9F,0xA0,0xA0,0x9F,0x9F,0x9F,0x9E,0x9C,0x9B,0x99,0x98,0x97,0x95,0x94,0x92,0x90,0x8E,0x8C,0x00};
	int i=0, j=0, begin, end, temple[analyze_number] = {0} ; //begin，end用于确定两边的纵坐标，temple用于存储每个点的纵坐标
	int *a0=&i, *b0=&j;	//分别对应斜率和截距
	for (i = 0; i < 30; i++) {
		for (j = 0; j < 30; j++) {
			//if (a[i][j]>140)
				//a[i][j] = 1;
			//else
				//a[i][j] = 0;
			printf("%d  ", a[i][j]);	//输出像素矩阵
		}
		printf("\n");
	}

	for (j = delete_left; j< 30-delete_right; j++) {
		for (i = delete_left; i < 30-delete_right; i++) {
			if (abs(a[i][j] - a[i + 1][j]) >= limit_number) {
				begin = i;
				break;
			}
		}
		for (i = 30 - delete_right-1; i > delete_left-1; i--) {
			if (abs(a[i][j] - a[i - 1][j])>limit_number) {
				end = i;
				break;
			}
		}
		temple[j- delete_left] = (end + begin) / 2;	//求解出边中心的纵坐标
	}

	for (i = 0; i < analyze_number; i++) {
		printf("%d  ", temple[i]);	//输出纵坐标
	}
	line(temple, a0, b0);
	printf("\n%d\t%d", *a0, *b0);

	getchar();
	return 0;

}

void line(int a[analyze_number],int *a0,int *b0) {
	int i;
	int y=0, x=0, x_x=0, x_y=0;
	for (i = delete_left+1; i < 30+1-delete_right; i++) {
		x = x + i;
		y = y + a[i- delete_left-delete_right];
		x_x = x_x + i*i;
		x_y = x_y + a[i- delete_left-delete_right] * i;
	}
	//最小二乘法拟合直线b = (∑Yi) / m - a1(∑Xi) / m  k= [∑Xi Yi - (∑Xi ∑Yi) / m] / [∑Xi2 - (∑Xi)2 / m)]
	*a0= (x_y - x_y / analyze_number) / (x_x + x_x / analyze_number);
	*b0 = y / analyze_number - (*a0)*x / analyze_number;
	return 0;
}